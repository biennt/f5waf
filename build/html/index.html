<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Web Application Firewall and API Protection &mdash; f5waf  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            f5waf
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Advanced Web Application Firewall and API Protection</a><ul>
<li><a class="reference internal" href="#i-gioi-thieu-tong-quan">I. Giới thiệu tổng quan</a></li>
<li><a class="reference internal" href="#ii-huong-dan-cau-hinh">II. Hướng dẫn cấu hình</a><ul>
<li><a class="reference internal" href="#tim-hieu-moi-truong-ung-dung-cac-thiet-lap-can-thiet-ban-dau">1. Tìm hiểu môi trường, ứng dụng, các thiết lập cần thiết ban đầu</a></li>
<li><a class="reference internal" href="#tao-security-policy">2. Tạo security policy</a><ul>
<li><a class="reference internal" href="#a-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-theo-loai-ung-dung-vi-du-wordpress">a. Khởi tạo chính sách bảo mật chế độ triển khai theo loại ứng dụng (ví dụ Wordpress)</a></li>
<li><a class="reference internal" href="#b-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-nhanh-rapid-deployment-policy">b. Khởi tạo chính sách bảo mật chế độ triển khai nhanh - Rapid deployment policy</a></li>
<li><a class="reference internal" href="#c-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-co-ban-fundamental">c. Khởi tạo chính sách bảo mật chế độ triển khai cơ bản - Fundamental</a></li>
<li><a class="reference internal" href="#d-khoi-tao-chinh-sach-bao-mat-de-chan-loc-cac-tan-cong-theo-owasp-top-10">d. Khởi tạo chính sách bảo mật để chặn lọc các tấn công theo OWASP Top 10</a></li>
<li><a class="reference internal" href="#e-cac-cach-thuc-bypass-chuc-nang-waf">e. Các cách thức bypass chức năng WAF</a></li>
</ul>
</li>
<li><a class="reference internal" href="#thiet-lap-cac-signatures-signatureset">3. Thiết lập các signatures, signatureSet</a></li>
<li><a class="reference internal" href="#thiet-lap-che-do-chan-dua-vao-dia-chi-ip-theo-khu-vuc-dia-ly">4. Thiết lập chế độ chặn dựa vào địa chỉ IP theo khu vực địa lý</a></li>
<li><a class="reference internal" href="#thiet-lap-che-do-chan-dua-vao-dia-chi-ip-doc-hai">5. Thiết lập chế độ chặn dựa vào địa chỉ IP độc hại</a></li>
<li><a class="reference internal" href="#thiet-lap-che-do-chong-tan-cong-do-quet-mat-khau">6. Thiết lập chế độ chống tấn công dò quét mật khẩu</a></li>
<li><a class="reference internal" href="#cau-hinh-cac-che-do-bao-ve-parameter">7. Cấu hình các chế độ bảo vệ parameter</a></li>
<li><a class="reference internal" href="#tinh-nang-ma-hoa-du-lieu-tren-trinh-duyet">8. Tính năng mã hóa dữ liệu trên trình duyệt</a></li>
<li><a class="reference internal" href="#sao-luu-va-phuc-hoi-chinh-sach-bao-mat">9. Sao lưu và phục hồi chính sách bảo mật</a></li>
</ul>
</li>
<li><a class="reference internal" href="#iii-lien-he-ho-tro">III. Liên hệ hỗ trợ</a></li>
</ul>
</li>
</ul>
</div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">f5waf</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Advanced Web Application Firewall and API Protection</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="advanced-web-application-firewall-and-api-protection">
<h1>Advanced Web Application Firewall and API Protection<a class="headerlink" href="#advanced-web-application-firewall-and-api-protection" title="Permalink to this heading"></a></h1>
<section id="i-gioi-thieu-tong-quan">
<h2>I. Giới thiệu tổng quan<a class="headerlink" href="#i-gioi-thieu-tong-quan" title="Permalink to this heading"></a></h2>
<p>Web Application Firewall (WAF) - Web Application and API Protection (WAAP)</p>
</section>
<section id="ii-huong-dan-cau-hinh">
<h2>II. Hướng dẫn cấu hình<a class="headerlink" href="#ii-huong-dan-cau-hinh" title="Permalink to this heading"></a></h2>
<section id="tim-hieu-moi-truong-ung-dung-cac-thiet-lap-can-thiet-ban-dau">
<h3>1. Tìm hiểu môi trường, ứng dụng, các thiết lập cần thiết ban đầu<a class="headerlink" href="#tim-hieu-moi-truong-ung-dung-cac-thiet-lap-can-thiet-ban-dau" title="Permalink to this heading"></a></h3>
<p>Trước hết, cần cấu hình lưu log các vi phạm, trên giao diện quản trị web của F5 BIG-IP, vào menu <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Event</span> <span class="pre">Logs</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Logging</span> <span class="pre">Profiles</span></code>, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code></p>
<p>Tại màn hình tiếp theo:</p>
<ul class="simple">
<li><p>Đặt tên cho profile, ví dụ <code class="docutils literal notranslate"><span class="pre">security_log_profile</span></code></p></li>
<li><p>Chọn <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> (đối với tính năng WAF và API Protection)</p></li>
<li><p>Chọn <code class="docutils literal notranslate"><span class="pre">DoS</span> <span class="pre">Protection</span></code> (đối với tính năng Layer 7 Dos Protection)
Nếu chọn mục <code class="docutils literal notranslate"><span class="pre">DoS</span> <span class="pre">Protection</span></code>, cần chọn ô <code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">Publisher</span></code> trong tab tương ứng hiện ra sau đó</p></li>
<li><p>Chọn <code class="docutils literal notranslate"><span class="pre">Bot</span> <span class="pre">Defense</span></code> (đối với tính năng Layer 7 Dos Protection)
Nếu chọn mục <code class="docutils literal notranslate"><span class="pre">Bot</span> <span class="pre">Defense</span></code>, cần chọn ô <code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">Publisher</span></code> trong tab tương ứng hiện ra sau đó. Ngoài ra, đối với <code class="docutils literal notranslate"><span class="pre">Bot</span> <span class="pre">Defense</span></code>, cần chọn thêm ít nhất 1 loại request cần log, ví dụ <code class="docutils literal notranslate"><span class="pre">Untrusted</span> <span class="pre">Bot</span></code>, <code class="docutils literal notranslate"><span class="pre">Malicious</span> <span class="pre">Bot</span></code>, <code class="docutils literal notranslate"><span class="pre">Suspicious</span> <span class="pre">Browser</span></code></p></li>
</ul>
<p>Bấm vào <code class="docutils literal notranslate"><span class="pre">Create</span></code> để tạo log profile.</p>
</section>
<section id="tao-security-policy">
<h3>2. Tạo security policy<a class="headerlink" href="#tao-security-policy" title="Permalink to this heading"></a></h3>
<blockquote>
<div><p>Lưu ý: Trước khi tiến hành các bước dưới đây (với bất kỳ loại policy nào), cần đảm bảo rằng ứng dụng đang hoạt động với F5 BIG-IP đóng vai trò như thiết bị cân bằng tải, reverse proxy. Nghĩa là các cấu hình liên quan như DNS, node, pool, monitor, ssl, virtual server đều đang hoạt động đúng và người sử dụng có thể truy cập bình thường.</p>
</div></blockquote>
<section id="a-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-theo-loai-ung-dung-vi-du-wordpress">
<h4>a. Khởi tạo chính sách bảo mật chế độ triển khai theo loại ứng dụng (ví dụ Wordpress)<a class="headerlink" href="#a-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-theo-loai-ung-dung-vi-du-wordpress" title="Permalink to this heading"></a></h4>
<p>Trường hợp này, người quản trị bảo mật đã có hiểu biết rằng ứng dụng mà mình đang thiếp lập chính sách bảo mật được phát triển dựa trên wordpress
(https://vi.wordpress.org/). Không tiến hành các bước bên dưới nếu không phải.</p>
<p>Trên giao diện quản trị web của F5 BIG-IP, vào menu <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Security</span> <span class="pre">Policies</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span> <span class="pre">List</span></code>, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code>.</p>
<p>Trong màn hình tiếp theo:</p>
<ul class="simple">
<li><p>Policy Name : đặt tên cho policy, ví dụ <code class="docutils literal notranslate"><span class="pre">wordpress_waf_policy</span></code></p></li>
<li><p>Policy Template: chọn mục <code class="docutils literal notranslate"><span class="pre">Application-ready</span> <span class="pre">templates</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Wordpress</span> <span class="pre">v4.9</span></code></p></li>
<li><p>Virtual Server: chọn virtual server sẽ apply (đang chạy Wordpress trên đó)</p></li>
<li><p>Logging Profiles: chọn logging profile đã tạo ở bước trên, ví dụ <code class="docutils literal notranslate"><span class="pre">security_log_profile</span></code></p></li>
</ul>
<p>Bấm vào nút <code class="docutils literal notranslate"><span class="pre">Save</span></code> để lưu lại. Như vậy, ứng dụng đã được bảo vệ.</p>
<blockquote>
<div><p>Để kiểm tra xem chính sách bảo mật này có đang hoạt động hay không, có thể thử một dạng tấn công vào lỗ hổng bảo mật của Wordpress, ví dụ CVE-2014-4663 (https://blog.sucuri.net/2011/08/attacks-against-timthumb-php-in-the-wild-list-of-themes-and-plugins-being-scanned.html).
Để thực hiện khai thác lỗ hổng, gửi một GET request tới đường dẫn <code class="docutils literal notranslate"><span class="pre">/wp-content/plugins/wordpress-gallery-plugin/timthumb.php?src=http://picasa.com12345.dyndns.org/1.php</span></code>. Nếu cấu hình thành công, hệ thống F5 BIG-IP sẽ chặn khai thác này, đưa ra một thông báo lỗi và kèm theo đó là một số <code class="docutils literal notranslate"><span class="pre">Support</span> <span class="pre">ID</span></code>, ghi nhận lại mã số này để tra cứu log. Truy cập vào giao diện quản trị F5 BIG-IP, vào mục <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Event</span> <span class="pre">Logs</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Requests</span></code>, nhập mã Support ID vào bộ lọc tìm kiếm, ta sẽ thấy một bản ghi log liên quan đến việc F5 BIG-IP chặn lại hành vi khai thác lỗ hổng bảo mật này.</p>
</div></blockquote>
</section>
<section id="b-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-nhanh-rapid-deployment-policy">
<h4>b. Khởi tạo chính sách bảo mật chế độ triển khai nhanh - Rapid deployment policy<a class="headerlink" href="#b-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-nhanh-rapid-deployment-policy" title="Permalink to this heading"></a></h4>
<p>Trường hợp này, người quản trị hệ thống muốn cấu hình nhanh một chính sách bảo mật mà qua đó có thể áp dụng ngay, không mất quá nhiều thời gian cho hệ thống tự học (learn) cũng như giảm thiểu tình trạng false positive alarms.
Nói chung, kiểu triển khai này có thể giải quyết được đa số các yêu cầu về bảo mật cho một ứng dụng web.</p>
<p>Trên giao diện quản trị web của F5 BIG-IP, vào menu <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Security</span> <span class="pre">Policies</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span> <span class="pre">List</span></code>, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code>.</p>
<p>Trong màn hình tiếp theo:</p>
<ul class="simple">
<li><p>Policy Name : đặt tên cho policy, ví dụ <code class="docutils literal notranslate"><span class="pre">rapid_waf_policy</span></code></p></li>
<li><p>Policy Template: chọn mục <code class="docutils literal notranslate"><span class="pre">Rapid</span> <span class="pre">Deployment</span> <span class="pre">Policy</span></code></p></li>
<li><p>Virtual Server: chọn virtual server sẽ apply (đang chạy ứng dụng trên đó)</p></li>
<li><p>Logging Profiles: chọn logging profile đã tạo ở bước trên, ví dụ <code class="docutils literal notranslate"><span class="pre">security_log_profile</span></code></p></li>
<li><p>Enforcement Mode: được đặt là <code class="docutils literal notranslate"><span class="pre">Transparent</span></code> - nghĩa là hệ thống vẫn kiểm tra nhưng không chặn ngay cả khi có vi phạm. Điều này giúp người quản trị bảo mật có thời gian xem xét các thiết lập bảo mật trước khi chuyển sang chế độ <code class="docutils literal notranslate"><span class="pre">Block</span></code>. Nếu muốn, người quản trị có thể bật chế độ <code class="docutils literal notranslate"><span class="pre">Blocking</span></code> ngay tại bước này.</p></li>
<li><p>Signature Staging: mặc định được bật (<code class="docutils literal notranslate"><span class="pre">Enable</span></code>), nghĩa là hệ thống sẽ chưa chặn ngay các vi phạm dựa trên signature nhằm tránh tình trạng false positive. Nếu muốn, người quản trị có thể <code class="docutils literal notranslate"><span class="pre">Disable</span></code> chế độ này luôn.</p></li>
<li><p>Server Technologies: có thể nhập (chọn trong danh sách) các công nghệ mà ứng dụng đang sử dụng, ví dụ phổ biến như Apache làm web server, engine PHP, cơ sở dữ liệu MySQL.. Các thiết lập này giúp F5 BIG-IP xây dựng bộ các signature cho phù hợp.</p></li>
</ul>
<p>Bấm vào nút <code class="docutils literal notranslate"><span class="pre">Save</span></code> để lưu lại. Như vậy, ứng dụng đã được bảo vệ (nếu <code class="docutils literal notranslate"><span class="pre">Enforcement</span> <span class="pre">Mode</span></code> là <code class="docutils literal notranslate"><span class="pre">Blocking</span></code> và <code class="docutils literal notranslate"><span class="pre">Signature</span> <span class="pre">Staging</span></code> là <code class="docutils literal notranslate"><span class="pre">Disable</span></code>)</p>
<blockquote>
<div><p>Để kiểm tra xem chính sách bảo mật này có đang hoạt động hay không, có thể thử một dạng tấn công dò quét xem hệ thống có vô tình chứa file phpinfo.php hay không (file này thường chứa hàm gọi <code class="docutils literal notranslate"><span class="pre">phpinfo()</span></code> sẽ hiện ra rất nhiều thông tin hệ thống của web server cũng như môi trường PHP, hacker có thể khai thác các thông tin này để thực hiện các hành vi tấn công nguy hiểm khác.
Để thực hiện khai thác lỗ hổng, gửi một GET request tới đường dẫn <code class="docutils literal notranslate"><span class="pre">/phpinfo.php</span></code>. Nếu cấu hình thành công, hệ thống F5 BIG-IP sẽ chặn khai thác này, đưa ra một thông báo lỗi và kèm theo đó là một số <code class="docutils literal notranslate"><span class="pre">Support</span> <span class="pre">ID</span></code>, ghi nhận lại mã số này để tra cứu log. Truy cập vào giao diện quản trị F5 BIG-IP, vào mục <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Event</span> <span class="pre">Logs</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Requests</span></code>, nhập mã Support ID vào bộ lọc tìm kiếm, ta sẽ thấy một bản ghi log liên quan đến việc F5 BIG-IP chặn lại hành vi khai thác lỗ hổng bảo mật này.</p>
</div></blockquote>
<p>Để xem chi tiết hơn về những thiết lập của dạng Rapid Deployment Policy, có thể truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policy</span> <span class="pre">Building</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Learning</span> <span class="pre">and</span> <span class="pre">Blocking</span> <span class="pre">Settings</span></code> (chọn đúng tên policy, ví dụ: rapid_waf_policy)</p>
</section>
<section id="c-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-co-ban-fundamental">
<h4>c. Khởi tạo chính sách bảo mật chế độ triển khai cơ bản - Fundamental<a class="headerlink" href="#c-khoi-tao-chinh-sach-bao-mat-che-do-trien-khai-co-ban-fundamental" title="Permalink to this heading"></a></h4>
<p>Trường hợp này, người quản trị mong muốn hệ thống F5 BIG-IP đưa ra các chính sách bảo mật tự động. Dựa vào lưu lượng thực tế F5 BIG-IP sẽ đưa ra các đánh giá và gợi ý và thậm chí tự động áp dụng các luật bảo vệ.</p>
<p>Trên giao diện quản trị web của F5 BIG-IP, vào menu <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Security</span> <span class="pre">Policies</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span> <span class="pre">List</span></code>, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code>.</p>
<p>Trong màn hình tiếp theo:</p>
<ul class="simple">
<li><p>Policy Name : đặt tên cho policy, ví dụ <code class="docutils literal notranslate"><span class="pre">fundamental_waf_policy</span></code></p></li>
<li><p>Policy Template: chọn mục <code class="docutils literal notranslate"><span class="pre">Fundamental</span></code></p></li>
<li><p>Virtual Server: chọn virtual server sẽ apply (đang chạy ứng dụng trên đó)</p></li>
<li><p>Logging Profiles: chọn logging profile đã tạo ở bước trên, ví dụ <code class="docutils literal notranslate"><span class="pre">security_log_profile</span></code></p></li>
<li><p>Enforcement Mode được đặt là <code class="docutils literal notranslate"><span class="pre">Blocking</span></code> ngay khi chọn Policy Template là Fundamental</p></li>
<li><p>Policy Building Learning Mode: chuyển về chế độ Automatic (Fully Automatic)</p></li>
<li><p>Trusted IP Addresses: người quản trị nên thiết lập một vài địa chỉ IP hoặc dải mạng tin cậy, nhờ đó F5 BIG-IP có thể tự động thiếp lập chính sách bảo mật và không chặn các địa chỉ IP này trong quá trình học và xây dựng chính sách bảo mật.</p></li>
<li><p>Policy Builder Learning Speed: mặc định là <code class="docutils literal notranslate"><span class="pre">Medium</span></code> (học càng chậm càng chặt chẽ nhưng đòi hỏi ứng dụng có nhiều người truy cập hàng ngày và ngược lại)</p></li>
<li><p>Signature Staging: mặc định được bật (<code class="docutils literal notranslate"><span class="pre">Enable</span></code>), nghĩa là hệ thống sẽ chưa chặn ngay các vi phạm dựa trên signature nhằm tránh tình trạng false positive. Nếu muốn, người quản trị có thể <code class="docutils literal notranslate"><span class="pre">Disable</span></code> chế độ này luôn.</p></li>
<li><p>Server Technologies: có thể nhập (chọn trong danh sách) các công nghệ mà ứng dụng đang sử dụng, ví dụ phổ biến như Apache làm web server, engine PHP, cơ sở dữ liệu MySQL.. Các thiết lập này giúp F5 BIG-IP xây dựng bộ các signature cho phù hợp.</p></li>
</ul>
<p>Bấm vào nút <code class="docutils literal notranslate"><span class="pre">Save</span></code> để lưu lại. Như vậy, ứng dụng đã được bảo vệ (nếu <code class="docutils literal notranslate"><span class="pre">Enforcement</span> <span class="pre">Mode</span></code> là <code class="docutils literal notranslate"><span class="pre">Blocking</span></code> và <code class="docutils literal notranslate"><span class="pre">Signature</span> <span class="pre">Staging</span></code> là <code class="docutils literal notranslate"><span class="pre">Disable</span></code>)</p>
<p>Bước tiếp theo, từ các địa chỉ Trusted IP, người dùng, người quản trị làm việc, thao tác với ứng dụng như bình thường để hệ thống F5 BIG-IP thu thập dữ liệu, học và gợi ý các chính sách.</p>
<p>Để xem hệ thống gợi ý những gì, truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policy</span> <span class="pre">Building</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Traffic</span> <span class="pre">Learning</span></code></p>
<p>Ví dụ như hình minh hoạ dưới đây:
<img alt="traffic learning" src="_images/traffic_learning.png" /></p>
<p>Người quản trị có thể chọn một trong các hành động:</p>
<ul class="simple">
<li><p>Accept: chấp nhận gợi ý, chuyển thành thiết lập chính thức. Để ý phần score (%), con số này càng lớn nghĩa là F5 BIG-IP càng tự tin với gợi ý đó, khả năng gợi ý chính xác càng cao.</p></li>
<li><p>Delete: xoá gợi ý này, không lưu gì vào policy. Gợi ý có thể lặp lại lần sau nếu có lưu lượng phù hợp. Trường hợp người quản trị chưa chắc chắn lắm về gợi ý có chính xác không nhưng muốn xoá tại thời điểm hiện tại</p></li>
<li><p>Ignore: bỏ qua gợi ý này và yêu cầu F5 BIG-IP không lặp lại gợi ý như vậy nữa (nghĩa là báo với hệ thống này rằng gợi ý như vậy là không đúng, không cần thay đổi gì về policy)</p></li>
<li><p>Export: lưu thông tin gợi ý này ra một file html để nghiên cứu phân tích hoặc gửi đi các bộ phận khác tham khảo trước khi quyết định.</p></li>
</ul>
<p>Sau khi hoàn tất quá trình Review các gợi ý, nếu người quản trị muốn apply ngay cách luật đã được chấp nhận, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code></p>
<p>Để xem các thiết lập hiện thời, truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policy</span> <span class="pre">Building</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Learning</span> <span class="pre">and</span> <span class="pre">Blocking</span> <span class="pre">Settings</span></code></p>
<p>Để xem chi tiết về những File types, Parameters.. mà hệ thống học được, truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">types</span></code> hoặc <code class="docutils literal notranslate"><span class="pre">Parameters</span></code>..</p>
<p>Ví dụ như hình minh hoạ dưới đây, hệ thống đã học được một số loại file types như png, php</p>
<p>Ví dụ như hình minh hoạ dưới đây, hệ thống tự học được các dạng file như jpg, png, php. Có 2 loại đặc biệt là * và no_ext:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">*</span></code> nghĩa là các loại file còn lại (wildcard)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">no_ext</span></code> nghĩa là không có phần mở rộng file nào trong URL</p></li>
</ul>
<p><img alt="allowed_file_types" src="_images/allowed_file_types.png" /></p>
<p>Tương tự như với 2 loại tạo chính sách bảo mật ở trên, người quản trị cũng có thể kiểm thử việc chặn truy cập không hợp lệ bằng một số kiểu tấn công/khai thác nào đó (Command Injection, SQL Injection, Cross-site scripting..).</p>
</section>
<section id="d-khoi-tao-chinh-sach-bao-mat-de-chan-loc-cac-tan-cong-theo-owasp-top-10">
<h4>d. Khởi tạo chính sách bảo mật để chặn lọc các tấn công theo OWASP Top 10<a class="headerlink" href="#d-khoi-tao-chinh-sach-bao-mat-de-chan-loc-cac-tan-cong-theo-owasp-top-10" title="Permalink to this heading"></a></h4>
<p>Trường hợp này, người quản trị bảo mật có mong muốn cấu hình các chính sách bảo mật nhằm ngăn chặn các tấn công được liệt kê trong danh sách Top 10 của OWASP.</p>
<blockquote>
<div><p>Lưu ý: đây chỉ là các gợi ý, dẫn dắt (guide) của F5 BIG-IP về việc thiết lập một hệ thống WAF sao cho tuân thủ và chống lại được top 10 loại tấn công được liệt kê của tổ chức OWASP. Trong quá trình thiết lập, người quản trị cần <strong>cân nhắc kỹ càng</strong> mỗi khi cấu hình một mục nào đó. Đồng thời, có một số mục nằm ngoài hệ thống WAF này, nhưng vẫn là một mục cần phải làm để tuân thủ, hệ thống này <strong>tin tưởng hoàn toàn</strong> vào người quản trị khi đưa ra quyết định rằng: <em>“tôi đã thực hiện điều đó rồi”</em>.</p>
</div></blockquote>
<p>Trên giao diện quản trị web của F5 BIG-IP, vào menu <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Guided</span> <span class="pre">Configuration</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Web</span> <span class="pre">Application</span> <span class="pre">Protection</span></code>.</p>
<p>Bên dưới có 3 mục nhỏ:</p>
<ul class="simple">
<li><p>Web Application Comprehensive Protection: hệ thống sẽ hướng dẫn người quản trị cấu hình bảo vệ ứng dụng web một cách toàn diện (bao gồm cả WAF, DDOS, Bot Defense, hạn chế truy cập theo vùng địa lý, chặn địa chỉ IP độc hại)</p></li>
<li><p>Web Application Protection: hệ thống sẽ hướng dẫn người quản trị cấu hình bảo vệ web với chức năng WAF. Ví dụ để bảo vệ trước các dạng tấn công Top 10 OWASP</p></li>
<li><p>Traffic Security Policy: Thực hiện các chức năng bảo vệ (WAF) theo những điều kiện nhất định mà người quản trị cần chỉ rõ</p></li>
</ul>
<p><img alt="guided_config_waf" src="_images/guided_config_waf.png" /></p>
<p>Trong phạm vi của hướng dẫn này, ta chọn mục thứ 2: <strong>Web Application Protection</strong>.</p>
<p>Tại màn hình tiếp theo, hệ thống gợi ý về những việc cần/sẽ thực hiện. Trong đó có một số yêu cầu bắt buộc:</p>
<ul class="simple">
<li><p>Cấu hình DNS cho F5 BIG-IP, nếu người quản trị chưa thực hiện, có thể bấm vào đường link tương ứng để đến phần config DNS. Người quản trị có thể chọn bất cứ một DNS server nào cho phép truy vấn recursive, ví dụ 8.8.8.8 và/hoặc 1.1.1.1</p></li>
<li><p>Cấu hình NTP cho F5 BIG-IP, phần này là để F5 BIG-IP có thể đồng bộ thời gian chính xác cho bản thân nó. Có thể chọn máy chủ vn.pool.ntp.org</p></li>
<li><p>F5 BIG-IP cần có một default route và được phép truy cập trực tiếp ra Internet để có thể thực hiện các chức năng của mình, ví dụ cập nhật signature, database địa chỉ IP..</p></li>
</ul>
<p>Cần thực hiện đầy đủ 3 mục trên trước khi bấm <code class="docutils literal notranslate"><span class="pre">Next</span></code> ở màn hình này.</p>
<p><img alt="guided_config_waf_top10-1" src="_images/guided_config_waf_top10-1.png" /></p>
<p>Tiếp theo, hệ thống sẽ yêu cầu nhập vào hoặc lựa chọn các thông tin:</p>
<ul class="simple">
<li><p>Security Policy Name: đặt tên cho policy, ví dụ <code class="docutils literal notranslate"><span class="pre">top10owasp</span></code></p></li>
<li><p>Select Enforcement Mode: chọn Transparent nếu không muốn hệ thống WAF chặn truy cập vi phạm, chọn Block nếu muốn chặn ngay.</p></li>
<li><p>Select type of policy to protect application: chọn <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Specific</span></code> và chọn loại ứng dụng đang cần cấu hình bảo vệ (Drupal, SharePoint, Wordpress, OWA Exchange), nếu không nằm trong danh sách hoặc không rõ, chọn <code class="docutils literal notranslate"><span class="pre">Generic</span></code></p></li>
<li><p>Application Language: để mặc định là <code class="docutils literal notranslate"><span class="pre">Unicode</span> <span class="pre">(utf-8)</span></code></p></li>
</ul>
<p>Bấm <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">&amp;</span> <span class="pre">Next</span></code>.</p>
<p>Tại màn hình tiếp theo, chọn <code class="docutils literal notranslate"><span class="pre">Assign</span> <span class="pre">Policy</span> <span class="pre">to</span> <span class="pre">Virtual</span> <span class="pre">Server(s)</span></code>. Ở bước này, người quản trị có 2 lựa chọn:</p>
<ul class="simple">
<li><p>Use Existing: sử dụng một virtual server đã cấu hình sẵn và đang hoạt động bình thường (<strong>khuyến nghị chọn mục này</strong>, vì trước khi cấu hình WAF, người quản trị nên hoàn thành để sau dễ troubleshoot, rollback)</p></li>
<li><p>Create New: tạo mới virtual server ngay tại màn hình này. Hệ thống yêu cầu người quản trị nhập vào các thông tin cần thiết để có thể tạo virtual server.</p></li>
</ul>
<p>Bấm <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">&amp;</span> <span class="pre">Next</span></code>.</p>
<p>Màn hình tiếp theo, hệ thống thông báo là các thông tin cần thiết đã đủ, sẵn sàng deploy. Bấm vào nút <code class="docutils literal notranslate"><span class="pre">Deploy</span></code></p>
<p>Màn hình tiếp theo, hệ thống thông báo các cấu hình đã được deploy. Bấm vào nút <code class="docutils literal notranslate"><span class="pre">Finish</span></code>.</p>
<p>Người quản trị cần thực hiện thêm một bước nữa: cấu hình/áp dụng security log profile cho virtual server đang bảo vệ. Vào menu <code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">Traffic</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Servers</span></code> &gt; bấm vào <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Server</span> <span class="pre">List</span></code>.
Sau đó, click chọn virtual server đang cần bảo vệ để xem cấu hình. Tại màn hình tiếp theo, chọn Tab <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span></code>.
Phần <code class="docutils literal notranslate"><span class="pre">Log</span> <span class="pre">Profile</span></code>, chọn security log profile muốn áp dụng rồi click vào nút <code class="docutils literal notranslate"><span class="pre">Update</span></code>. Có thể chọn một trong 2 loại có sẵn như <code class="docutils literal notranslate"><span class="pre">Log</span> <span class="pre">all</span> <span class="pre">requests</span></code> hoặc <code class="docutils literal notranslate"><span class="pre">Log</span> <span class="pre">illegal</span> <span class="pre">requests</span></code>, hoặc cũng có thể chọn loại đã được cấu hình từ trước như phần đầu của tài liệu này (bên trên, trong phần <code class="docutils literal notranslate"><span class="pre">Cấu</span> <span class="pre">hình</span> <span class="pre">lưu</span> <span class="pre">log</span> <span class="pre">các</span> <span class="pre">vi</span> <span class="pre">phạm</span></code>)</p>
<p>Xem lại tình trạng tuân thủ phòng chống Top 10 OWASP, truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Overview</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">OWASP</span> <span class="pre">Compliance</span></code>, click chọn policy vừa tạo.
Màn hình bên trái sẽ hiện ra tình trạng tuân thủ với Top 10 OWASP</p>
<p><img alt="guided_config_waf_top10-2" src="_images/guided_config_waf_top10-2.png" /></p>
<p>Như hình minh họa phía trên nghĩa là tỉ lệ tuân thủ là 0/10 - chưa có mục nào tuân thủ hoàn toàn. Trong đó mục A2 và A3 chỉ tuân thủ 1 phần (theo % tương ứng được hiển thị).</p>
<p>Người quản trị cần xem chi tiết các mục và đánh giá xem có cần thực hiện các biện pháp gì, cấu hình gì để đảm bảo tuân thủ.</p>
<p>Ví dụ với mục <strong>A1 Injection</strong>, bấm vào đó, hệ thống sẽ cho chúng ta biết cần áp dụng:</p>
<ul class="simple">
<li><p>Danh sách các loại signature chống tấn công (Buffer Overflow, Command Execution..)</p></li>
<li><p>Thực hiện thiết lập bảo vệ chống các cơ chế che dấu tấn công (Evasion Techniques)</p></li>
</ul>
<p><img alt="guided_config_waf_top10-3" src="_images/guided_config_waf_top10-3.png" /></p>
<p>Đối với các loại signature, bấm vào con số tương ứng (số lượng yêu cầu), hệ thống sẽ đưa ra màn hình cấu hình các signature, ví dụ bấm vào số 6, mục Buffer Overflow, hệ thống chỉ ra các signature cần áp dụng như hình minh họa dưới đây:</p>
<p><img alt="guided_config_waf_top10-4" src="_images/guided_config_waf_top10-4.png" /></p>
<p>Như trường hợp trên, cả 6 signature này đang được cấu hình trong policy, tuy vậy chúng ở chế độ Staging (theo dõi vi phạm, chưa chặn ngay để tránh nhầm lẫn). Người quản trị cần test kỹ ứng dụng (và rà soát Event Logs) xem có khả năng bị chặn nhầm không? Nếu không, có thể chuyển từ chế độ Staging thành Enforce bằng cách chọn các signature đó và click vào nút <code class="docutils literal notranslate"><span class="pre">Enforce</span></code> và click vào <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code>.</p>
<p>Sau đó lại quay trở lại màn hình <code class="docutils literal notranslate"><span class="pre">OWASP</span> <span class="pre">Compliance</span></code>, lúc này sẽ thấy tỉ lệ tuân thủ cho mục A1 tăng lên (ví dụ, không còn là 0% nữa).
Thực hiện các bước tương tự với tất cả các loại Signature khác.</p>
<p>Riêng đối với một số cơ chế bảo vệ, ví dụ <code class="docutils literal notranslate"><span class="pre">Evasion</span> <span class="pre">Techniques</span></code>, người quản trị có 2 lựa chọn:</p>
<ul class="simple">
<li><p>Bỏ qua (ignore): bấm vào biểu tượng có hình tròn và đường gạch chéo</p></li>
</ul>
<p><img alt="guided_config_waf_top10-5" src="_images/guided_config_waf_top10-5.png" /></p>
<p>Sau đó click vào <code class="docutils literal notranslate"><span class="pre">Review</span> <span class="pre">&amp;</span> <span class="pre">Update</span></code> và <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">&amp;</span> <span class="pre">Apply</span></code>. Lúc này hệ thống hiểu rằng người quản trị không muốn áp dụng cơ chế này (có thể làm ảnh hưởng đến hoạt động bình thường của ứng dụng, chấp nhận rủi ro) nhưng vẫn muốn đánh dấu hạng mục này là hoàn thành (để đạt được 100%)</p>
<ul class="simple">
<li><p>Áp dụng (Enforce): bấm vào biểu tượng có dấu tick</p></li>
</ul>
<p><img alt="guided_config_waf_top10-6" src="_images/guided_config_waf_top10-6.png" /></p>
<p>Sau đó click vào <code class="docutils literal notranslate"><span class="pre">Review</span> <span class="pre">&amp;</span> <span class="pre">Update</span></code> và <code class="docutils literal notranslate"><span class="pre">Save</span> <span class="pre">&amp;</span> <span class="pre">Apply</span></code>. Lúc này hệ thống hiểu rằng người quản trị muốn áp dụng cơ chế bảo vệ này, và đánh dấu hoàn thành công việc.</p>
<p>Cứ như vậy, người quản trị làm lần lượt từ mục A2 đến A10, đôi khi, làm mục này xong thì tỉ lệ tuân thủ các mục khác cũng tự tăng lên vì chúng có cùng yêu cầu bảo mật. Ví dụ nếu hoàn thành A1 (100%), ta cũng sẽ được kết quả như sau:</p>
<p><img alt="guided_config_waf_top10-7" src="_images/guided_config_waf_top10-7.png" /></p>
<p>Một số mục có tính chất <em>gợi ý</em>, không có tác động nào thực tế được thực hiện, chẳng hạn mục A10:</p>
<p><img alt="guided_config_waf_top10-8" src="_images/guided_config_waf_top10-8.png" /></p>
<ul class="simple">
<li><p>Log Illegal Requests: ghi log các vi phạm</p></li>
<li><p>Remote Logging: ghi log ra log server bên ngoài</p></li>
</ul>
<p>Người quản trị hệ thống có thể cấu hình trên F5 BIG-IP để thực hiện các yêu cầu này hoặc không (tự giác), sau đó đánh dấu vào là đã tuân thủ hoặc bỏ qua.</p>
<p>Cá biệt, có những yêu cầu nằm ngoài hoàn toàn hệ thống F5 BIG-IP, chẳng hạn vấn đề rò quét lỗ hổng, cập nhật bản vá như dưới đây:</p>
<p><img alt="guided_config_waf_top10-9" src="_images/guided_config_waf_top10-9.png" /></p>
<p>Nếu đã, đang và sẽ thực hiện định kỳ đầy đủ các hạng mục này, người quản trị có thể click vào nút đáp ứng “Requirement fulfilled”.</p>
<p>Thực hiện tuân thủ Top 10 OWASP là một nỗ lực tập thể, nhiều thành phần cùng phải thực hiện. Hệ thống F5 BIG-IP chỉ đóng vai trò dẫn hướng và cấu hình các cơ chế bảo mật nhất định mà nó kiểm soát được.</p>
</section>
<section id="e-cac-cach-thuc-bypass-chuc-nang-waf">
<h4>e. Các cách thức bypass chức năng WAF<a class="headerlink" href="#e-cac-cach-thuc-bypass-chuc-nang-waf" title="Permalink to this heading"></a></h4>
<p>Trong quá trình áp dụng các chính sách, luật bảo vệ, có thể có lúc cần phải bypass tạm thời việc này, ví dụ để troubleshoot dễ dàng hơn. Có 2 cách thực hiện trên thiết bị F5 BIG-IP</p>
<p><strong>Chuyển qua lại chế độ Blocking và Transparent</strong></p>
<p>Truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Security</span> <span class="pre">Policies</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span> <span class="pre">List</span></code> (chọn đúng tên policy đang cần tác động).
<img alt="security_policy_config" src="_images/security_policy_config.png" />
Tại mục Enforcement Mode, chọn Transparent. Sau đó bấm nút <code class="docutils literal notranslate"><span class="pre">Save</span></code> và <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code>. Ở chế độ Transparent, hệ thống vẫn kiểm tra các truy cập, tuy nhiên sẽ không chặn ngay cả khi có vi phạm, có thể log lại các vi phạm này để người quản trị xem lại, phân tích.</p>
<p><strong>Chuyển qua lại chế độ bypass tính năng WAF</strong></p>
<p>Vào menu <code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">Traffic</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Servers</span></code> &gt; bấm vào <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Server</span> <span class="pre">List</span></code>.
Sau đó, click chọn virtual server đang cần bypass. Tại màn hình tiếp theo, chọn Tab <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span></code>.
Phần <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span> <span class="pre">Policy</span></code>, chọn <code class="docutils literal notranslate"><span class="pre">Disabled</span></code>.</p>
<p><img alt="bypass_waf" src="_images/bypass_waf.png" /></p>
<p>Với cách này, hệ thống F5 BIG-IP chỉ hoạt động đơn thuần như một thiết bị cân bằng tải hoặc reverse proxy, không có bất cứ một request nào được kiểm tra về mặt bảo mật. Mọi vi phạm cũng không được xem xét hay ghi log lại.</p>
</section>
</section>
<section id="thiet-lap-cac-signatures-signatureset">
<h3>3. Thiết lập các signatures, signatureSet<a class="headerlink" href="#thiet-lap-cac-signatures-signatureset" title="Permalink to this heading"></a></h3>
<p>Phần này mặc định rằng người quản trị đã cấu hình một chính sách bảo mật để bảo vệ ứng dụng web, tuy nhiên trong quá trình hoạt động thấy cần thiết phải thay đổi các dấu hiệu tấn công (attack signature). Ở đây:</p>
<ul class="simple">
<li><p>Signature (hay viết đầy đủ là attack signature): là một nhận dạng về dấu hiệu tấn công cụ thể. Hệ thống F5 BIG-IP có một cơ sở dữ liệu về các dấu hiệu tấn công như vậy và thường xuyên được cập nhật. Nếu trong quá trình kiểm tra HTTP request hoặc HTTP response, dữ liệu phù hợp với quy luật nhận dạng như vậy có thể sẽ bị coi là vi phạm chính sách bảo mật khi signature đó được áp dụng.</p></li>
<li><p>SignatureSet là một tập hợp các signature, được nhóm theo một thể loại nào đó.</p></li>
</ul>
<p>Để xem các signature đang được áp dụng đối với một policy, truy cấp vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Security</span> <span class="pre">Policies</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span> <span class="pre">List</span></code>, chọn policy cần xem. Sau đó bấm vào mục <code class="docutils literal notranslate"><span class="pre">Attack</span> <span class="pre">Signatures</span></code></p>
<p>Ví dụ:</p>
<p><img alt="attack_signature" src="_images/attack_signature.png" /></p>
<p>Với mỗi signature, bấm vào biểu tượng mũi tên sẽ cho biết thông tin chi tiết, ví dụ:</p>
<p><img alt="attack_signature" src="_images/attack_signature-1.png" /></p>
<p>Trong đó, lưu ý một số thông tin sau:</p>
<ul class="simple">
<li><p>Signature name: tên gọi của signature, phần nào đoán được nó là gì</p></li>
<li><p>Signature ID: mã định danh của signature, sử dụng để tìm kiếm, mã định danh này là duy nhất đối với F5</p></li>
<li><p>Learn: tạo ra các gợi ý cho người quản trị về việc có nên áp dụng signature này không dựa vào lưu lượng thực tế (Learning Suggestion)</p></li>
<li><p>Alarm: tạo cảnh báo nếu có vi phạm</p></li>
<li><p>Block: chặn tấn công nếu có vi phạm</p></li>
<li><p>Staging: để ở chế độ giám sát, chưa chặn</p></li>
<li><p>Enforce: thực hiện chặn vi phạm</p></li>
</ul>
<p>Chế độ Signature Staging giúp hạn chế việc chặn nhầm vì nó chỉ tạo cảnh báo, giúp người quản trị có thời gian xem xét.</p>
<p>Ví dụ, việc truy cập vào một URI dạng phpinfo.php trong khi signature ID: 200010015 đang được bật, sẽ tạo ra một cảnh báo trong Events Log như sau:</p>
<p><img alt="attack_signature" src="_images/attack_signature-2.png" /></p>
<p>Trong đó nêu rõ các thông tin về vi phạm này, động thời cũng chỉ ra rằng Signature này đang ở chế độ Staging (Staged), nên vi phạm vẫn được bỏ qua trên thực tế (thể hiện bằng mã 200 trả về từ máy chủ).</p>
<p>Nếu người quản trị cho rằng signature này cần phải chặn ngay lập tức, có thể vào mục <code class="docutils literal notranslate"><span class="pre">Attack</span> <span class="pre">Signatures</span></code> của policy tương ứng, tìm signature có ID đang cần thay đổi (trường hợp này là 200010015):</p>
<p><img alt="attack_signature" src="_images/attack_signature-3.png" /></p>
<p>Chọn signature đó và bấm vào nút <code class="docutils literal notranslate"><span class="pre">Enforce</span></code>:</p>
<p><img alt="attack_signature" src="_images/attack_signature-4.png" /></p>
<p>Sau đó xác nhận lại ở hộp thoại tiếp theo và bấm vào nút <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code>. Sau bước này, signature đó đã chuyển sang chế độ chặn trên thực tế (<code class="docutils literal notranslate"><span class="pre">Enforced</span></code>).</p>
<p>Người quản trị nên kiểm thử lại để xem kết quả</p>
<p>Truy cập sẽ bị chặn, với một thông báo tương tự như sau tại phía người dùng:</p>
<p><img alt="attack_signature" src="_images/attack_signature-5.png" /></p>
<p>trong Events Log như sau:</p>
<p><img alt="attack_signature" src="_images/attack_signature-6.png" /></p>
<blockquote>
<div><p>Lưu ý: trong phần log trên, <code class="docutils literal notranslate"><span class="pre">Applied</span> <span class="pre">Blocking</span> <span class="pre">Settings</span></code> đã là <code class="docutils literal notranslate"><span class="pre">Block</span></code> <code class="docutils literal notranslate"><span class="pre">Alarm</span></code> <code class="docutils literal notranslate"><span class="pre">Learn</span></code>, đồng thời không có mã trả về từ server nữa mà thay vào đó là N/A và một cái biển cấm mầu đỏ.</p>
</div></blockquote>
<p>Ngược lại, nếu biết chắc rằng signature đó là chặn nhầm, cần phải cho phép người dùng truy cập mà không chặn hay cảnh báo gì cả, người quản trị có thể tắt signature đó đi (Disable), truy cập vào phần <code class="docutils literal notranslate"><span class="pre">Attack</span> <span class="pre">Signature</span></code>, chọn signature đó và bấm vào nút <code class="docutils literal notranslate"><span class="pre">Disable</span></code>, sau đó <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code></p>
<p><img alt="attack_signature" src="_images/attack_signature-7.png" /></p>
<p>Sau khi disable, cũng nên kiểm tra lại xem truy cập đã bình thường chưa, có log vi phạm gì không.</p>
<p>Với SignatureSet, thay vì thực hiện theo từng signature cụ thể như trên (có hàng nghìn signature như vậy), người quản trị có thể bật tắt theo nhóm.</p>
<p>Truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policy</span> <span class="pre">Building</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Learning</span> <span class="pre">and</span> <span class="pre">Blocking</span> <span class="pre">Settings</span></code>, chọn policy tương ứng, mở rộng mục <code class="docutils literal notranslate"><span class="pre">Attack</span> <span class="pre">Signatures</span></code>:</p>
<p><img alt="attack_signature" src="_images/attack_signature-8.png" /></p>
<p>Nếu muốn thêm bớt các SignatureSet, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Change</span></code></p>
<p><img alt="attack_signature" src="_images/attack_signature-9.png" /></p>
<blockquote>
<div><p>Lưu ý: cần bấm vào nút <code class="docutils literal notranslate"><span class="pre">Save</span></code> bên dưới và sau đó bấm vào nút <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code> bên trên để thay đổi có hiệu lực ngay.</p>
</div></blockquote>
</section>
<section id="thiet-lap-che-do-chan-dua-vao-dia-chi-ip-theo-khu-vuc-dia-ly">
<h3>4. Thiết lập chế độ chặn dựa vào địa chỉ IP theo khu vực địa lý<a class="headerlink" href="#thiet-lap-che-do-chan-dua-vao-dia-chi-ip-theo-khu-vuc-dia-ly" title="Permalink to this heading"></a></h3>
<p>Trong một số trường hợp, người quản trị muốn cho phép hoặc ngăn chặn các truy cập đến từ một khu vực địa lý cụ thể nào đó. Để làm điều này, truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Geolocation</span> <span class="pre">Enforcement</span></code>. Ví dụ dưới đây là chặn truy cập từ Đài Loan:</p>
<p><img alt="geoblocking.png" src="_images/geoblocking.png" /></p>
<blockquote>
<div><p>Lưu ý: bấm <code class="docutils literal notranslate"><span class="pre">Save</span></code> và <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code> để thiết lập có hiệu lực ngay.</p>
</div></blockquote>
<p>Kiểm tra trong Event Log:</p>
<p><img alt="geoblocking.png" src="_images/geoblocking-1.png" /></p>
<p>Một thiết lập như bên dưới đây sẽ chỉ cho phép truy cập từ Việt Nam:</p>
<p><img alt="geoblocking.png" src="_images/geoblocking-2.png" /></p>
</section>
<section id="thiet-lap-che-do-chan-dua-vao-dia-chi-ip-doc-hai">
<h3>5. Thiết lập chế độ chặn dựa vào địa chỉ IP độc hại<a class="headerlink" href="#thiet-lap-che-do-chan-dua-vao-dia-chi-ip-doc-hai" title="Permalink to this heading"></a></h3>
<p>Để thực hiện được tính năng này, cần đăng ký dịch vụ <code class="docutils literal notranslate"><span class="pre">IP</span> <span class="pre">Intelligent</span></code>, cách làm như sau:</p>
<p>Vào mục <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Network</span> <span class="pre">Firewall</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">IP</span> <span class="pre">Intelligence</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span></code>. Bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code> để tạo mới policy</p>
<p><img alt="ipi.png" src="_images/ipi.png" /></p>
<p>Thực hiện:</p>
<ul class="simple">
<li><p>Đặt tên cho policy</p></li>
<li><p>Thiết lập Default Action: hành động mặc định, ví dụ Drop</p></li>
<li><p>Thiết lập Default Log Actions: mặc định có ghi log hay không</p></li>
<li><p>Phần Category, thêm hoặc bớt các Category mong muốn kiểm soát</p></li>
</ul>
<p><img alt="ipi.png" src="_images/ipi-1.png" /></p>
<p>Cuối cùng, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Commit</span> <span class="pre">Changes</span> <span class="pre">to</span> <span class="pre">System</span></code>.
Bước tiếp theo, áp dụng policy này cho Virtual Server:
Vào <code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">Traffic</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Servers</span> <span class="pre">:</span> <span class="pre">Virtual</span> <span class="pre">Server</span> <span class="pre">List</span></code>  ›› chọn virtual server đang cần tác động, ví dụ <code class="docutils literal notranslate"><span class="pre">vs_https_dvwa</span></code> như minh họa bên dưới, chọn Tab <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span></code>:</p>
<p>Trong mục <code class="docutils literal notranslate"><span class="pre">IP</span> <span class="pre">Intelligence</span></code>, chọn <code class="docutils literal notranslate"><span class="pre">Enabled</span></code> và chọn policy mới tạo ở trên</p>
<p><img alt="ipi.png" src="_images/ipi-2.png" /></p>
<p>Click vào nút <code class="docutils literal notranslate"><span class="pre">Update</span></code>.</p>
<p>Để xem log các vi phạm này, vào <code class="docutils literal notranslate"><span class="pre">Security</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Event</span> <span class="pre">Logs</span> <span class="pre">:</span> <span class="pre">Network</span> <span class="pre">:</span> <span class="pre">IP</span> <span class="pre">Intelligence</span></code></p>
</section>
<section id="thiet-lap-che-do-chong-tan-cong-do-quet-mat-khau">
<h3>6. Thiết lập chế độ chống tấn công dò quét mật khẩu<a class="headerlink" href="#thiet-lap-che-do-chong-tan-cong-do-quet-mat-khau" title="Permalink to this heading"></a></h3>
<p>Một trong những hình thức tấn công tương đối phổ biến vào các ứng dụng web là tấn công dò quét mật khẩu (brute-force attack). Kẻ tấn công biết được username, và sẽ thử nhiều lần với nhiều mật khẩu khác nhau cho đến khi thành công. Ví dụ dưới đây sẽ hướng dẫn cách cấu hình cho một ứng dụng cụ thể, các ứng dụng khác nhau sẽ có cách quản lý đăng nhập khác nhau, tham số khác nhau, cần có phân tích và hiểu biết nhất định trước khi thực hiện. Về cơ bản, các bước cần thực hiện trên hệ thống F5 BIG-IP là:</p>
<ul class="simple">
<li><p>Tạo <code class="docutils literal notranslate"><span class="pre">Login</span> <span class="pre">URL</span></code>, <code class="docutils literal notranslate"><span class="pre">Logout</span> <span class="pre">URL</span></code></p></li>
<li><p>Cấu hình <code class="docutils literal notranslate"><span class="pre">Session</span> <span class="pre">Tracking</span></code></p></li>
<li><p>Cấu hình <code class="docutils literal notranslate"><span class="pre">Brute-force</span> <span class="pre">attack</span> <span class="pre">Prevention</span></code></p></li>
</ul>
<p>Để tạo Login URL, cần biết ứng dụng nhận thông tin đăng nhập bằng cách nào:</p>
<ul class="simple">
<li><p>Giao thức HTTP hay HTTPS</p></li>
<li><p>URL (ví dụ /login.php)</p></li>
<li><p>Method (ví dụ POST)</p></li>
<li><p>Parameter (ví dụ username, userid, password, pwd..)</p></li>
<li><p>Nhận biết kết quả đăng nhập thành công hay thất bại thông qua response. Ví dụ trả về response code 200 hoặc 403, hoặc trả về 200 kèm theo đoạn text thể hiện thành công hay thất bại, hoặc thông tin nằm trong response header..</p></li>
</ul>
<p>Để tạo Login URL, truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span> <span class="pre">:</span> <span class="pre">Sessions</span> <span class="pre">and</span> <span class="pre">Logins</span> <span class="pre">:</span> <span class="pre">Login</span> <span class="pre">Pages</span> <span class="pre">List</span></code>, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code> để tạo mới:</p>
<p><img alt="loginurl" src="_images/loginurl.png" /></p>
<p>Sau đó bấm vào nút <code class="docutils literal notranslate"><span class="pre">Save</span></code>, tương tự, tạo Logout URL, để hệ thống biết khi nào người dùng Logout và ngừng theo dõi phiên làm việc của user.</p>
<p>Để tạo Logout URL, truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span> <span class="pre">:</span> <span class="pre">Sessions</span> <span class="pre">and</span> <span class="pre">Logins</span> <span class="pre">:</span> <span class="pre">Logout</span> <span class="pre">Pages</span> <span class="pre">List</span></code>, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code> để tạo mới:</p>
<p><img alt="logout" src="_images/logout.png" /></p>
<p>Tiếp theo, bật tính năng theo dõi phiên làm việc của người dùng - <code class="docutils literal notranslate"><span class="pre">Session</span> <span class="pre">Tracking</span></code>, vào <code class="docutils literal notranslate"><span class="pre">Security</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span> <span class="pre">:</span> <span class="pre">Sessions</span> <span class="pre">and</span> <span class="pre">Logins</span> <span class="pre">:</span> <span class="pre">Session</span> <span class="pre">Tracking</span></code>, bật <code class="docutils literal notranslate"><span class="pre">Session</span> <span class="pre">Awareness</span></code> trên <code class="docutils literal notranslate"><span class="pre">Login</span> <span class="pre">URL</span></code> vừa tạo:</p>
<p><img alt="sessiontracking" src="_images/sessiontracking.png" /></p>
<p>Sau đó bấm <code class="docutils literal notranslate"><span class="pre">Save</span></code> và <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code></p>
<p>Vào <code class="docutils literal notranslate"><span class="pre">Security</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span> <span class="pre">:</span> <span class="pre">Brute</span> <span class="pre">Force</span> <span class="pre">Attack</span> <span class="pre">Prevention</span></code>, bấm nút <code class="docutils literal notranslate"><span class="pre">Create</span></code> để tạo một cấu hình mới:</p>
<ul class="simple">
<li><p>Lựa chọn login URL (login page) đã tạo ở bước trước.</p></li>
<li><p>Thiết lập cho cơ chế bảo vệ dựa vào địa chỉ nguồn (Source-based Brute Force Protection)</p></li>
<li><p>Thiết lập cho cơ chế bị tấn công phân tán (Distributed Brute Force Protection)</p></li>
</ul>
<p><img alt="bruteforce" src="_images/bruteforce.png" /></p>
<p>Sau đó bấm <code class="docutils literal notranslate"><span class="pre">Save</span></code> và <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code></p>
<p>Vào giao diện command line, gõ các lệnh sau:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tmsh</span> <span class="n">modify</span> <span class="n">sys</span> <span class="n">db</span> <span class="n">asm</span><span class="o">.</span><span class="n">cs_qualified_urls</span> <span class="n">value</span> <span class="s2">&quot;/login.php&quot;</span>
<span class="n">save</span> <span class="n">sys</span> <span class="n">config</span>
</pre></div>
</div>
<p><strong>Phần dưới đây sẽ là một thử nghiệm tấn công</strong></p>
<p>Thử đăng nhập vào ứng dụng với tài khoản hợp lệ, đảm bảo rằng việc đăng nhập xảy ra bình thường.</p>
<p>Thử đăng nhập vào ứng dụng với cùng username, nhưng sai mật khẩu, đảm bảo rằng ứng dụng vẫn hoạt động bình thường, có thông báo từ ứng dụng cho người dùng biết răng họ đã đăng nhập sai mật khẩu.</p>
<p>Với các thiết lập ở trên, thử đăng nhập vào ứng dụng sai liên tiếp 4 hoặc 5 lần trong 3 phút. Để ý kỹ, tại lần thứ 5, trình duyệt sẽ có 1 lần refresh do bị kích hoạt cơ chế phòng vệ <code class="docutils literal notranslate"><span class="pre">client-site</span> <span class="pre">integrity</span></code>, F5 BIG-IP sẽ gửi javascript tới trình duyệt, yêu cầu nó thực hiện và gửi lại kết quả.</p>
<p>Khảo sát Events Log, ta sẽ nhìn thấy một vi phạm như sau:</p>
<p><img alt="bruteforce" src="_images/bruteforce-1.png" /></p>
<p>Thông tin trên cho thấy việc đăng nhập sai quá 3 lần đã được ghi nhận, hệ thống đã gửi javascript cho trình duyệt và javascript đó đã thực hiện thành công. Người dùng thực tế không nhận ra sự khác biệt rõ ràng nhưng máy chủ phía sau đã được bảo vệ.</p>
<p>Tuy nhiên, cách thức dò quét như trên là đối với một trình duyệt bình thường, người dùng bình thường. Kẻ tấn công có chủ đích thường viết script, chạy bot để tốc độ dò quét mật khẩu nhanh hơn, dưới đây là một đoạn script rất đơn giản để thử nghiệm:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="n">echo</span> <span class="s2">&quot;login lan thu 1&quot;</span>
<span class="n">curl</span> <span class="s1">&#39;https://dvwa.bienlab.com/login.php&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Accept-Language: en,en-US;q=0.9,vi;q=0.8&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Cache-Control: max-age=0&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Connection: keep-alive&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Cookie: BIGIPAuthUsernameCookie=admin; f5currenttab=&quot;main&quot;; f5mainmenuopenlist=&quot;&quot;; f5advanceddisplay=&quot;&quot;; security=low; TS019fa5f1030=0; f5_refreshpage=&quot;https%3A//dvwa.bienlab.com%3A8443/dms/policy/requests_ng.php&quot;; BIGIPAuthCookie=kXZiWN1Ealng5up2idtyjYncdqw3J8pyMXm1HUSN; PHPSESSID=voonj10j3v6kgml8fbujpb5m47; f5formpage=&quot;/tmui/locallb/pool/resources.jsp?name=/Common/dvwa_pool&quot;; TS019fa5f1=01ed81241150ca5c383559014eddb5ef5d6bcbc02d47f468362b4900732ac291511109b1e111b49704f1ceca516e3ef872921f9d3f&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Origin: https://dvwa.bienlab.com&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Referer: https://dvwa.bienlab.com/login.php&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Dest: document&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Mode: navigate&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Site: same-origin&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-User: ?1&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Upgrade-Insecure-Requests: 1&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;111&quot;, &quot;Not(A:Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;111&quot;&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua-mobile: ?0&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua-platform: &quot;Windows&quot;&#39;</span> \
  <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">&#39;username=admin&amp;password=password1&amp;Login=Login&amp;user_token=2b8360ffb89776248f4580e7627873e5&#39;</span> \
  <span class="o">-</span><span class="n">i</span>

<span class="n">sleep</span> <span class="mi">1</span>

<span class="n">echo</span> <span class="s2">&quot;login lan thu 2&quot;</span>
<span class="n">curl</span> <span class="s1">&#39;https://dvwa.bienlab.com/login.php&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Accept-Language: en,en-US;q=0.9,vi;q=0.8&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Cache-Control: max-age=0&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Connection: keep-alive&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Cookie: BIGIPAuthUsernameCookie=admin; f5currenttab=&quot;main&quot;; f5mainmenuopenlist=&quot;&quot;; f5advanceddisplay=&quot;&quot;; security=low; TS019fa5f1030=0; f5_refreshpage=&quot;https%3A//dvwa.bienlab.com%3A8443/dms/policy/requests_ng.php&quot;; BIGIPAuthCookie=kXZiWN1Ealng5up2idtyjYncdqw3J8pyMXm1HUSN; PHPSESSID=voonj10j3v6kgml8fbujpb5m47; f5formpage=&quot;/tmui/locallb/pool/resources.jsp?name=/Common/dvwa_pool&quot;; TS019fa5f1=01ed81241150ca5c383559014eddb5ef5d6bcbc02d47f468362b4900732ac291511109b1e111b49704f1ceca516e3ef872921f9d3f&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Origin: https://dvwa.bienlab.com&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Referer: https://dvwa.bienlab.com/login.php&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Dest: document&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Mode: navigate&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Site: same-origin&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-User: ?1&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Upgrade-Insecure-Requests: 1&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;111&quot;, &quot;Not(A:Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;111&quot;&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua-mobile: ?0&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua-platform: &quot;Windows&quot;&#39;</span> \
  <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">&#39;username=admin&amp;password=password2&amp;Login=Login&amp;user_token=2b8360ffb89776248f4580e7627873e5&#39;</span> \
  <span class="o">-</span><span class="n">i</span>

<span class="n">sleep</span> <span class="mi">1</span>

<span class="n">echo</span> <span class="s2">&quot;login lan thu 3&quot;</span>
<span class="n">curl</span> <span class="s1">&#39;https://dvwa.bienlab.com/login.php&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Accept-Language: en,en-US;q=0.9,vi;q=0.8&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Cache-Control: max-age=0&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Connection: keep-alive&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Cookie: BIGIPAuthUsernameCookie=admin; f5currenttab=&quot;main&quot;; f5mainmenuopenlist=&quot;&quot;; f5advanceddisplay=&quot;&quot;; security=low; TS019fa5f1030=0; f5_refreshpage=&quot;https%3A//dvwa.bienlab.com%3A8443/dms/policy/requests_ng.php&quot;; BIGIPAuthCookie=kXZiWN1Ealng5up2idtyjYncdqw3J8pyMXm1HUSN; PHPSESSID=voonj10j3v6kgml8fbujpb5m47; f5formpage=&quot;/tmui/locallb/pool/resources.jsp?name=/Common/dvwa_pool&quot;; TS019fa5f1=01ed81241150ca5c383559014eddb5ef5d6bcbc02d47f468362b4900732ac291511109b1e111b49704f1ceca516e3ef872921f9d3f&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Origin: https://dvwa.bienlab.com&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Referer: https://dvwa.bienlab.com/login.php&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Dest: document&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Mode: navigate&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Site: same-origin&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-User: ?1&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Upgrade-Insecure-Requests: 1&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;111&quot;, &quot;Not(A:Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;111&quot;&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua-mobile: ?0&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua-platform: &quot;Windows&quot;&#39;</span> \
  <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">&#39;username=admin&amp;password=password3&amp;Login=Login&amp;user_token=2b8360ffb89776248f4580e7627873e5&#39;</span> \
  <span class="o">-</span><span class="n">i</span>

<span class="n">sleep</span> <span class="mi">1</span>

<span class="n">echo</span> <span class="s2">&quot;login lan thu 4&quot;</span>
<span class="n">curl</span> <span class="s1">&#39;https://dvwa.bienlab.com/login.php&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Accept-Language: en,en-US;q=0.9,vi;q=0.8&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Cache-Control: max-age=0&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Connection: keep-alive&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Cookie: BIGIPAuthUsernameCookie=admin; f5currenttab=&quot;main&quot;; f5mainmenuopenlist=&quot;&quot;; f5advanceddisplay=&quot;&quot;; security=low; TS019fa5f1030=0; f5_refreshpage=&quot;https%3A//dvwa.bienlab.com%3A8443/dms/policy/requests_ng.php&quot;; BIGIPAuthCookie=kXZiWN1Ealng5up2idtyjYncdqw3J8pyMXm1HUSN; PHPSESSID=voonj10j3v6kgml8fbujpb5m47; f5formpage=&quot;/tmui/locallb/pool/resources.jsp?name=/Common/dvwa_pool&quot;; TS019fa5f1=01ed81241150ca5c383559014eddb5ef5d6bcbc02d47f468362b4900732ac291511109b1e111b49704f1ceca516e3ef872921f9d3f&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Origin: https://dvwa.bienlab.com&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Referer: https://dvwa.bienlab.com/login.php&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Dest: document&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Mode: navigate&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-Site: same-origin&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Sec-Fetch-User: ?1&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Upgrade-Insecure-Requests: 1&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/111.0.0.0 Safari/537.36&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;111&quot;, &quot;Not(A:Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;111&quot;&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua-mobile: ?0&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;sec-ch-ua-platform: &quot;Windows&quot;&#39;</span> \
  <span class="o">--</span><span class="n">data</span><span class="o">-</span><span class="n">raw</span> <span class="s1">&#39;username=admin&amp;password=password4&amp;Login=Login&amp;user_token=2b8360ffb89776248f4580e7627873e5&#39;</span> \
  <span class="o">-</span><span class="n">i</span>
</pre></div>
</div>
<p>Kết quả của script trên đối với 3 lần đầu đều là đã kết nối thành công với ứng dụng:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">302</span> <span class="n">Found</span>
<span class="n">Date</span><span class="p">:</span> <span class="n">Fri</span><span class="p">,</span> <span class="mi">17</span> <span class="n">Mar</span> <span class="mi">2023</span> <span class="mi">05</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span><span class="mi">57</span> <span class="n">GMT</span>
<span class="n">Expires</span><span class="p">:</span> <span class="n">Thu</span><span class="p">,</span> <span class="mi">19</span> <span class="n">Nov</span> <span class="mi">1981</span> <span class="mi">08</span><span class="p">:</span><span class="mi">52</span><span class="p">:</span><span class="mi">00</span> <span class="n">GMT</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">store</span><span class="p">,</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span><span class="p">,</span> <span class="n">must</span><span class="o">-</span><span class="n">revalidate</span>
<span class="n">Pragma</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Location</span><span class="p">:</span> <span class="n">login</span><span class="o">.</span><span class="n">php</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Keep</span><span class="o">-</span><span class="n">Alive</span><span class="p">:</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100</span>
<span class="n">Connection</span><span class="p">:</span> <span class="n">Keep</span><span class="o">-</span><span class="n">Alive</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span><span class="p">;</span> <span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>
<span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">TS019fa5f1</span><span class="o">=</span><span class="mi">01</span><span class="n">ed81241183390baccd3be0bf73ebc284e33a0b890ada820025f4c65fad8a68ada0a492224bc71c668a44484fab0182f61637ab44</span><span class="p">;</span> <span class="n">Path</span><span class="o">=/</span>
</pre></div>
</div>
<p>Tuy nhiên tại lần thứ 4, kết quả mã trả về 200 (không phải từ ứng dụng), hệ thống cũng gửi cho client một file binary chứa script khiến một công cụ như <code class="docutils literal notranslate"><span class="pre">curl</span></code> không thể hoàn thành như đối với một trình duyệt bình thường.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Length</span><span class="p">:</span> <span class="mi">6313</span>
<span class="n">Pragma</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Cache</span><span class="o">-</span><span class="n">Control</span><span class="p">:</span> <span class="n">no</span><span class="o">-</span><span class="n">cache</span>
<span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>
<span class="n">Set</span><span class="o">-</span><span class="n">Cookie</span><span class="p">:</span> <span class="n">TS019fa5f1078</span><span class="o">=</span><span class="n">c70512a20b0a810b08f0888080b08dd4b08c011a140a03706870180a20840b28ffffffff0f3059380022230801120a2f6c6f67696e2e7068702999c2d3d3d6f175073801400158006a04504f5354288f0130f2033a260a08757365726e616d65120561646d696e1a012a200128057801a80100e80101f00105f801013a260a0870617373776f726412052a2a2a2a2a1a012a200128097801a80100e80101f00105f801013a230a054c6f67696e12054c6f67696e1a012a200128057801a80100e80101f00105f801013a430a0a757365725f746f6b656e122032623833363066666238393737363234386634353830653736323738373365351a012a200128207801a80100e80101f00105f8010142410a17424947495041757468557365726e616d65436f6f6b69651a122a1000000000000000000000000000000000220561646d696e280132012a380040014802580142350a0c663563757272656e747461621a122a100000000000000000000000000000000022046d61696e280132012a380040014802580142370a1266356d61696e6d656e756f70656e6c6973741a122a10000000000000000000000000000000002200280132012a380040014802580142360a116635616476616e636564646973706c61791a122a10000000000000000000000000000000002200280132012a380040014802580142300a0873656375726974791a122a100000000000000000000000000000000022036c6f77280132012a3800400148025801426f0a0e66355f72656672657368706167651a122a1000000000000000000000000000000000223c68747470732533412f2f647677612e6269656e6c61622e636f6d253341383434332f646d732f706f6c6963792f72657175657374735f6e672e706870280132012a3800400148025801425c0a0f424947495041757468436f6f6b69651a122a100000000000000000000000000000000022286b585a69574e3145616c6e6735757032696474796a596e63647177334a3870794d586d314855534e280132012a380040014802580142480a095048505345535349441a122a1000000000000000000000000000000000221a766f6f6e6a31306a3376366b676d6c386662756a7062356d3437280132012a380040014802580142660a0a6635666f726d706167651a122a100000000000000000000000000000000022372f746d75692f6c6f63616c6c622f706f6f6c2f7265736f75726365732e6a73703f6e616d653d2f436f6d6d6f6e2f647677615f706f6f6c280132012a38004001480258014a122a100000000000008000000000000000000052122a10000000000000000000000000000000005a1c10f42d189aae7c20ff3f2a100413000008002d8af800000000000000621c10f42d189aee7d20ff3f2a100417020008002d8ac0035f60000000006a1c10f42d189aee7d20ff3f2a100417020008002d8ac0035f60000000007a1208001000188080fcff0f20f582f4a80328008001e2eccfa0068a0110647677612e6269656e6c61622e636f6d9001b093aceb96a9a9f017b00102da01216170706c69636174696f6e2f782d7777772d666f726d2d75726c656e636f646564f20102564efa010561646d696e880213980206a00280808020a802b093aceb96a9a9f017c202122a1000000200000000000000000000000000d2020438353630d80201e00200e802c0df03f002bb03f80200800300880300900300980300a00304a80300b2031108001000188080fcff0f20f582f0682800b80300c00300ca03020816d80300e00300e80300880400ca04152f436f6d6d6f6e2f76735f68747470735f64767761d00400e2040508a208106fea040508ef061022f00404f804039205009a0500a00501aa051208041002180338b40140ac02480368047001c00500c80501d00500e80503f00501f80503920608485454502f312e31121c08f0888080b08dd4b08c01100018008001049001e2eccfa006c801002803300151e4e3ba1e1356266d5a132f436f6d6d6f6e2f647677615f706f6c69637903700400006b50618c</span><span class="p">;</span> <span class="n">Path</span><span class="o">=/</span><span class="p">;</span> <span class="n">Max</span><span class="o">-</span><span class="n">Age</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span>

<span class="ne">Warning</span><span class="p">:</span> <span class="n">Binary</span> <span class="n">output</span> <span class="n">can</span> <span class="n">mess</span> <span class="n">up</span> <span class="n">your</span> <span class="n">terminal</span><span class="o">.</span> <span class="n">Use</span> <span class="s2">&quot;--output -&quot;</span> <span class="n">to</span> <span class="n">tell</span>
<span class="ne">Warning</span><span class="p">:</span> <span class="n">curl</span> <span class="n">to</span> <span class="n">output</span> <span class="n">it</span> <span class="n">to</span> <span class="n">your</span> <span class="n">terminal</span> <span class="n">anyway</span><span class="p">,</span> <span class="ow">or</span> <span class="n">consider</span> <span class="s2">&quot;--output</span>
<span class="ne">Warning</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">FILE</span><span class="o">&gt;</span><span class="s2">&quot; to save to a file.</span>

</pre></div>
</div>
<p>Ghi nhận trong Events Log có một bản ghi thể hiện rằng việc dò quét mật khẩu đã bị phát hiện, cơ chế phòng vệ <code class="docutils literal notranslate"><span class="pre">Alarm</span> <span class="pre">and</span> <span class="pre">Client</span> <span class="pre">Side</span> <span class="pre">Integrity</span></code> cũng được kích hoạt nhưng không có phản ứng nào khác từ client (script trên không được thiết kế và tính đến khả năng này)</p>
<p><img alt="bruteforce" src="_images/bruteforce-2.png" /></p>
</section>
<section id="cau-hinh-cac-che-do-bao-ve-parameter">
<h3>7. Cấu hình các chế độ bảo vệ parameter<a class="headerlink" href="#cau-hinh-cac-che-do-bao-ve-parameter" title="Permalink to this heading"></a></h3>
<p>Các tham số - parameters đối với một ứng dụng web được hiểu là thông tin được người dùng (thông qua trình duyệt) gửi tới ứng dụng bằng một trong các phương thức như POST hoặc GET. Chẳng hạn như đối với tham số về địa chỉ IP trong form dưới đây:</p>
<p><img alt="parameter" src="_images/parameter.png" /></p>
<p>Người sử dụng chỉ nên nhập vào dữ liệu có dạng một địa chỉ IPv4 chẳng hạn, để hạn chế rủi ro bảo mật, người quản trị có thể định nghĩa tham số này (ip) chỉ bao gồm các ký tự dạng số <code class="docutils literal notranslate"><span class="pre">0-9</span></code> và dấu <code class="docutils literal notranslate"><span class="pre">.</span></code></p>
<p>Làm như vậy sẽ hạn chế được tương đối các khả năng chèn mã độc vào trong tham số này. Để cấu hình khả năng này, người quản trị thực hiện:</p>
<ul class="simple">
<li><p>Định nghĩa parameter thủ công nếu đang không bật chế độ học tự động</p></li>
<li><p>Với parameter đó, định nghĩa các loại ký tự được phép/không được phép và các tính năng khác nếu thấy cần thiết</p></li>
</ul>
<p>Để định nghĩa thủ công tham số này, truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span> <span class="pre">:</span> <span class="pre">Parameters</span> <span class="pre">:</span> <span class="pre">Parameters</span> <span class="pre">List</span></code>, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code> để tạo mới:</p>
<p><img alt="parameter" src="_images/parameter-1.png" /></p>
<ul class="simple">
<li><p>Parameter Name: đặt tên cho tham số, cái này phải chính xác với ứng dụng thực tế. Sử dụng các tính năng cho developer trên trình duyệt để tìm hiểu tên parameter.</p></li>
<li><p>Perform Staging: có thực thi các thiết lập này ngay lập tức không hay chỉ cảnh báo để tránh nhầm lẫn, sai sót. Ví dụ minh họa là thực hiện ngay (tắt Staging)</p></li>
<li><p>Minimum Length: độ dài tối thiểu của tham số này. Ví dụ với địa chỉ IP, độ dài tối thiểu là 7 (4 chữ số và 3 dấu chấm)</p></li>
<li><p>Maximum Length: độ dài tối đa của tham số này. Ví dụ trong trường hợp này là 15 (4 con số dài 3 chữ số và 3 dấu chấm).</p></li>
</ul>
<p>Click vào tab <code class="docutils literal notranslate"><span class="pre">Value</span> <span class="pre">Meta</span> <span class="pre">Characters</span></code>, thay đổi các ký tự được phép và không được phép đối với dữ liệu của tham số này (chỉ cho phép các con số <code class="docutils literal notranslate"><span class="pre">0-9</span></code> và dấu <code class="docutils literal notranslate"><span class="pre">.</span></code>)</p>
<p><img alt="parameter" src="_images/parameter-2.png" /></p>
<p>Click nút <code class="docutils literal notranslate"><span class="pre">Create</span></code> và <code class="docutils literal notranslate"><span class="pre">Apply</span> <span class="pre">Policy</span></code></p>
<p>Nếu có vi phạm, trong Events Log cũng sẽ chỉ ra cụ thể đối với tham số này:</p>
<p><img alt="parameter" src="_images/parameter-3.png" /></p>
<p>Chiến lược này gọi là Positive Security - chỉ ra các quy tắc hợp lệ để chặn các trường hợp còn lại.</p>
</section>
<section id="tinh-nang-ma-hoa-du-lieu-tren-trinh-duyet">
<h3>8. Tính năng mã hóa dữ liệu trên trình duyệt<a class="headerlink" href="#tinh-nang-ma-hoa-du-lieu-tren-trinh-duyet" title="Permalink to this heading"></a></h3>
<p>Hầu hết các tính năng WAF trong tài liệu này đều thực thi phía F5 BIG-IP, riêng đối với tính năng này là thực hiện tại trình duyệt của người dùng. Theo đó, một đoạn mã javascript sẽ được gửi tới trình duyệt của người dùng nhằm mã hóa các trường thông tin nhạy cảm (username, password..). Việc mã hóa này sẽ tránh được các plug-in độc hại trên trình duyệt đánh cắp các thông tin này.</p>
<p>Ví dụ, một form như dưới đây, khi người dùng nhập dữ liệu xong và chưa bấm vào nút <code class="docutils literal notranslate"><span class="pre">Login</span></code> (chưa submit dữ liệu), hoàn toàn có thể đọc thông tin trong form đó bằng các đoạn mã javascript, chẳng hạn lấy giá trị của password bằng hàm <code class="docutils literal notranslate"><span class="pre">document.forms[0].password.value</span></code> .</p>
<p><img alt="appencrypt" src="_images/appencrypt.png" /></p>
<p>Để mã hóa dữ liệu ngay từ phía trình duyệt (và nhiều tính năng cao cấp khác), cần cấu hình tính năng <code class="docutils literal notranslate"><span class="pre">DataSafe</span></code>.</p>
<p>Trước hết, cần bật module <code class="docutils literal notranslate"><span class="pre">Fraud</span> <span class="pre">Protection</span> <span class="pre">Service</span> <span class="pre">(FPS)</span></code></p>
<p><img alt="appencrypt" src="_images/appencrypt-1.png" /></p>
<p>Tạo một local log publisher để có thể xem log liên quan đến tính năng này ngay trên F5 BIG-IP</p>
<p><img alt="appencrypt" src="_images/appencrypt-2.png" /></p>
<blockquote>
<div><p>Khuyến nghị: cấu hình một máy chủ log bên ngoài, và đẩy log phần này ra đó nếu muốn lưu trữ lâu dài.</p>
</div></blockquote>
<p>Truy cập vào <code class="docutils literal notranslate"><span class="pre">Security</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Data</span> <span class="pre">Protection</span> <span class="pre">:</span> <span class="pre">BIG-IP</span> <span class="pre">DataSafe</span></code>, bấm vào nút <code class="docutils literal notranslate"><span class="pre">Create</span></code></p>
<p>Đặt tên cho profile, chỉ định Local Syslog Publisher vừa tạo bước trên.</p>
<p><img alt="appencrypt" src="_images/appencrypt-3.png" /></p>
<p>Bấm nút <code class="docutils literal notranslate"><span class="pre">Create</span></code> để tạo profile, sau đó tiếp tục cấu hình các URL, Parameter và tính năng bảo vệ.</p>
<p>Phần <code class="docutils literal notranslate"><span class="pre">URL</span> <span class="pre">List</span></code>, bấm nút <code class="docutils literal notranslate"><span class="pre">Add</span></code> để định nghĩa 1 URL cần bảo vệ. URL Path là <code class="docutils literal notranslate"><span class="pre">/login.php</span></code></p>
<p><img alt="appencrypt" src="_images/appencrypt-4.png" /></p>
<p>Phần Parameters, thêm vào 2 parameter là <code class="docutils literal notranslate"><span class="pre">username</span></code> và <code class="docutils literal notranslate"><span class="pre">password</span></code> như hình minh họa dưới đây (nhớ chọn mục <code class="docutils literal notranslate"><span class="pre">Encrypt</span></code>):</p>
<p><img alt="appencrypt" src="_images/appencrypt-5.png" /></p>
<p><img alt="appencrypt" src="_images/appencrypt-6.png" /></p>
<p>Bấm nút <code class="docutils literal notranslate"><span class="pre">Save</span></code> để lưu lại các parameter đối với URL này và <code class="docutils literal notranslate"><span class="pre">Back</span> <span class="pre">to</span> <span class="pre">Profile</span></code> để quay ra ngoài màn hình cấu hình profile và bấm vào nút <code class="docutils literal notranslate"><span class="pre">Save</span></code> để lưu lại cấu hình.</p>
<p>Để áp dụng tính năng này cho virtual server, truy cập vào <code class="docutils literal notranslate"><span class="pre">Local</span> <span class="pre">Traffic</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Virtual</span> <span class="pre">Servers</span> <span class="pre">:</span> <span class="pre">Virtual</span> <span class="pre">Server</span> <span class="pre">List</span></code>  ››  chọn virtual server cần bảo vệ ví dụ <code class="docutils literal notranslate"><span class="pre">vs_https_dvwa</span></code>, trong tab <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span></code>, phần <code class="docutils literal notranslate"><span class="pre">DataSafe</span> <span class="pre">Profile</span></code> chọn <code class="docutils literal notranslate"><span class="pre">Enabled</span></code> và chọn  profile vừa cấu hình như minh họa bên dưới:</p>
<p><img alt="appencrypt" src="_images/appencrypt-7.png" /></p>
<p>Click vào nút <code class="docutils literal notranslate"><span class="pre">Update</span></code> để lưu lại. Sau đó kiểm tra.</p>
<p>Quay trở lại trình duyệt, thử thực hiện lại hành động đọc thông tin từ trường password (đã được biến đổi thành các chữ <code class="docutils literal notranslate"><span class="pre">aaaaaaa</span></code>):</p>
<p><img alt="appencrypt" src="_images/appencrypt-8.png" /></p>
<p>Đặc biệt, khi submit thông tin, trường username được che dấu (obfuscate) và mã hóa (encrypt) như hình minh họa bên dưới:</p>
<p><img alt="appencrypt" src="_images/appencrypt-9.png" /></p>
</section>
<section id="sao-luu-va-phuc-hoi-chinh-sach-bao-mat">
<h3>9. Sao lưu và phục hồi chính sách bảo mật<a class="headerlink" href="#sao-luu-va-phuc-hoi-chinh-sach-bao-mat" title="Permalink to this heading"></a></h3>
<p>Để sao lưu (chính xác là <code class="docutils literal notranslate"><span class="pre">Export</span></code>), vào mục <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span> <span class="pre">:</span> <span class="pre">Security</span> <span class="pre">Policies</span> <span class="pre">:</span> <span class="pre">Policies</span> <span class="pre">List</span></code>, chọn policy cần export rồi bấm vào nút <code class="docutils literal notranslate"><span class="pre">Export</span></code> –&gt; <code class="docutils literal notranslate"><span class="pre">Export</span> <span class="pre">Policies</span></code>. Hệ thống sẽ cho download về một file có khuôn dạng XML hoặc nhị phân tùy thuộc vào lựa chọn.</p>
<p><img alt="export" src="_images/export.png" /></p>
<p>Để phục hồi chính sách bảo mật từ 1 file đã export trước đó, vào
<code class="docutils literal notranslate"><span class="pre">Security</span></code>  ››  <code class="docutils literal notranslate"><span class="pre">Application</span> <span class="pre">Security</span> <span class="pre">:</span> <span class="pre">Security</span> <span class="pre">Policies</span> <span class="pre">:</span> <span class="pre">Policies</span> <span class="pre">List</span></code>, chọn <code class="docutils literal notranslate"><span class="pre">Import</span> <span class="pre">Policy</span></code></p>
<p><img alt="import" src="_images/import.png" /></p>
<p>Sau đó vào phần cấu hình virtual server, mục <code class="docutils literal notranslate"><span class="pre">Security</span></code> &gt; <code class="docutils literal notranslate"><span class="pre">Policies</span></code> để áp dụng</p>
</section>
</section>
<section id="iii-lien-he-ho-tro">
<h2>III. Liên hệ hỗ trợ<a class="headerlink" href="#iii-lien-he-ho-tro" title="Permalink to this heading"></a></h2>
<p>Yêu cầu hỗ trợ kỹ thuật xin gửi đến địa chỉ: https://support.f5.com/</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Bien.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>